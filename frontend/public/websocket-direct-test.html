<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Debug Test</title>
</head>
<body>
    <h1>WebSocket Connection Test</h1>
    <div id="status">Checking...</div>
    <div id="logs"></div>

    <script>
        const logDiv = document.getElementById('logs');
        const statusDiv = document.getElementById('status');

        function log(message) {
            console.log(message);
            logDiv.innerHTML += '<p>' + message + '</p>';
        }

        // Test 1: Check if environment variables are accessible
        log('ğŸ” Checking environment variables...');

        // Since this is a static file, we can't access Next.js env directly
        // Let's try to connect to the known WebSocket URL
        const wsUrl = 'wss://virtualsol-production.up.railway.app/ws/prices';
        log('ğŸ“¡ WebSocket URL: ' + wsUrl);

        // Test 2: Try to create WebSocket connection
        log('ğŸ”Œ Attempting WebSocket connection...');
        
        try {
            const ws = new WebSocket(wsUrl, ['websocket']);
            
            ws.onopen = function(event) {
                log('âœ… WebSocket connected successfully!');
                statusDiv.innerHTML = 'âœ… Connected';
                
                // Subscribe to SOL price
                const subscription = {
                    type: 'subscribe',
                    tokens: ['So11111111111111111111111111111111111111112']
                };
                ws.send(JSON.stringify(subscription));
                log('ğŸ“¤ Sent subscription request');
            };
            
            ws.onmessage = function(event) {
                const data = JSON.parse(event.data);
                log('ğŸ“¨ Received message: ' + JSON.stringify(data, null, 2));
            };
            
            ws.onerror = function(error) {
                log('âŒ WebSocket error: ' + error);
                statusDiv.innerHTML = 'âŒ Error';
            };
            
            ws.onclose = function(event) {
                log('ğŸ”’ WebSocket closed: ' + event.code + ' - ' + event.reason);
                statusDiv.innerHTML = 'ğŸ”’ Closed';
            };
            
        } catch (error) {
            log('âŒ Failed to create WebSocket: ' + error.message);
            statusDiv.innerHTML = 'âŒ Failed';
        }
    </script>
</body>
</html>